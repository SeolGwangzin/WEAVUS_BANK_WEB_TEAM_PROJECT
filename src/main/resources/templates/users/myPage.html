<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MY PAGE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">

    <style>
        body { font-family: 'Noto Sans JP', sans-serif; margin: 0; background-color: #f4f7f9; color: #333; }
        .page-container { max-width: 800px; margin: 2em auto; padding: 2.5em; background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        h2 { text-align: center; margin: 0 0 1em 0; font-size: 28px; color: #2c3e50; font-weight: 700; }

        /* --- 공통 버튼 스타일 --- */
        .btn { display: inline-block; text-decoration: none; padding: 10px 20px; border-radius: 6px; font-weight: 500; text-align: center; cursor: pointer; transition: background-color 0.2s, box-shadow 0.2s; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-secondary:hover { background-color: #5a6268; }
        .btn[disabled] { background-color: #ccc; cursor: not-allowed; box-shadow: none; }

        /* --- 사용자 정보 섹션 --- */
        .user-info-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #e0e0e0; padding-bottom: 1em; margin-bottom: 1.5em; }
        .info-section { border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 2.5em; }
        .info-section dl { margin: 0; padding: 0; }
        .info-section .info-row { display: flex; border-bottom: 1px solid #e9ecef; }
        .info-section .info-row:last-child { border-bottom: none; }
        .info-section dt { background-color: #f8f9fa; padding: 15px; font-weight: 500; min-width: 150px; text-align: left; border-right: 1px solid #e9ecef; }
        .info-section dd { padding: 15px; margin: 0; flex-grow: 1; }

        /* --- 보유 계좌 섹션 --- */
        .account-list-header { border-bottom: 2px solid #e0e0e0; padding-bottom: 0.5em; margin-bottom: 1.5em; font-size: 20px; font-weight: 700; color: #2c3e50; }
        .account-box { border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 1.5em; }
        .account-box a { color: #007bff; text-decoration: none; font-weight: 500; }
        .account-box a:hover { text-decoration: underline; }
        .account-balance-info { display: flex; justify-content: space-between; align-items: center; background-color: #f8f9fa; padding: 10px 15px; border-top: 1px solid #e9ecef; }
        .no-data { text-align: center; padding: 3em 0; color: #777; }

        /* --- 하단 버튼 컨테이너 --- */
        .bottom-action { text-align: center; margin-top: 2em; }
    </style>
</head>
<body>

<div th:replace="~{navbar/navbar :: navbarFragment}"></div>

<div class="page-container">

    <div class="user-info-header">
        <h2>MY PAGE</h2>
        <a th:href="@{/update}" class="btn btn-secondary">情報変更</a>
    </div>

    <div class="info-section" th:object="${loginUser}">
        <dl>
            <div class="info-row"><dt>名前</dt><dd th:text="*{full_name}">***</dd></div>
            <div class="info-row"><dt>ID</dt><dd th:text="*{username}">***</dd></div>
<!--            <div class="info-row"><dt>誕生日</dt><dd th:text="*{#temporals.format(birthDate, 'yyyy/MM/dd')}">****/**/**</dd></div>-->
            <div class="info-row"><dt>性別</dt><dd th:text="*{gender}">男</dd></div>
            <div class="info-row"><dt>メール</dt><dd th:text="*{email}">****@***.***</dd></div>
            <div class="info-row"><dt>電話番号</dt><dd th:text="*{phone_number}">***-****-****</dd></div>
            <div class="info-row"><dt>郵便番号</dt><dd th:text="*{postal_code}">***-****</dd></div>
        </dl>
    </div>

    <div class="account-list-header">
        <span>保有口座一覧</span>
    </div>

    <div th:if="${#lists.isEmpty(accountsEntityList)}" class="no-data">
        <p>保有している口座がありません。</p>
    </div>

    <div th:if="${not #lists.isEmpty(accountsEntityList)}">
        <div class="account-box" th:each="account : ${accountsEntityList}">
            <dl>
                <div class="info-row">
                    <dt>口座番号</dt>
                    <dd>
                        <a th:href="@{/trans/list(accountNumber=${account.account_number})}">
                            <span th:id="'account-number-' + ${account.account_number}" th:text="${account.account_number}"></span>
                        </a>
                    </dd>
                </div>
                <div class="account-balance-info">
<!--                    <span><strong>登録日:</strong> <span th:text="${#temporals.format(account.date, 'yyyy-MM-dd')}"></span></span>-->
                    <span><strong>残高:</strong> <span th:text="${#numbers.formatInteger(account.balance, 0, 'COMMA')} + '円'"></span></span>
                </div>
            </dl>
        </div>
    </div>

    <div class="bottom-action" th:if="${#lists.size(accountsEntityList) < 2}">
        <a th:href="@{/accounts/create}" class="btn btn-primary">新規口座開設</a>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function formatAccountNumber(numberStr) {
            if (!numberStr) return '';
            return numberStr.replace(/(\d{4})(?=\d)/g, '$1-');
        }

        // 모든 계좌번호 span에 대해 서식과 마스킹 적용
        const accountSpans = document.querySelectorAll('[id^="account-number-"]');
        accountSpans.forEach(span => {
            const originalNumber = span.textContent;
            if (originalNumber.length > 4) {
                const partToKeep = originalNumber.substring(0, originalNumber.length - 4);
                const formattedPart = formatAccountNumber(partToKeep);
                span.textContent = formattedPart + '-****';
            } else {
                span.textContent = formatAccountNumber(originalNumber);
            }
        });
    });
</script>

</body>
</html>