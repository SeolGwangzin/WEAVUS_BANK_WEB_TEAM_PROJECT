<!DOCTYPE html>
<html lang="ja"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ホームページ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">

</head>
<body style="text-align: center">

<div th:replace="~{navbar/navbar :: navbarFragment}"></div>

<h1>銀行システムメイン画面</h1>
<h2>ようこそ、<span th:text="${名前}">名前</span>様！</h2>

<!-- 口座を持ってる場合 -->
<div th:if="${accounts != null and !accounts.isEmpty()}">
    <label>口座を選択：</label>
    <select id="accountSelect" name="accountId" onchange="onAccountChange(this)">
        <option th:each="acc : ${accounts}"
                th:text="${acc.getAccount_number()}"
                th:data-balance="${acc.getBalance()}"
                th:value="${acc.getId()}"></option>
    </select>

    <p>現在の残高：<span id="balanceDisplay"></span></p>
</div>
<!-- 口座を持ってない場合 -->
<div th:if="${accounts == null or accounts.isEmpty()}">
    <a th:href="@{/new}">新しい口座を作ってください</a>
</div>

<script>
    function onAccountChange(selectElement) {
        const selectedOption = selectElement.options[selectElement.selectedIndex];
        const balance = selectedOption.getAttribute("data-balance");
        const formattedBalance = Number(balance).toLocaleString();
        document.getElementById("balanceDisplay").textContent = formattedBalance + '円';
    }

    window.addEventListener("DOMContentLoaded", function () {
        const select = document.getElementById("accountSelect");
        if (select) {
            onAccountChange(select);
        }
    })
</script>
</body>
</html>